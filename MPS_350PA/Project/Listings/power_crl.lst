C51 COMPILER V9.60.7.0   POWER_CRL                                                         07/14/2025 11:08:35 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE POWER_CRL
OBJECT MODULE PLACED IN ..\Output\power_crl.obj
COMPILER INVOKED BY: D:\APP\Keil_v5\C51\BIN\C51.EXE ..\BSP\Src\power_crl.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\BSP\
                    -Inc;..\Core\Inc;..\Driver;..\Emembed\Inc;..\SYSTEM\Inc) DEBUG OBJECTEXTEND PRINT(.\Listings\power_crl.lst) OBJECT(..\Out
                    -put\power_crl.obj)

line level    source

   1          #include "power_crl.h"
   2          
   3          AC_CTRL ac_ctrl;
   4          
   5          /**
   6           * @brief       ç§»ç›¸è§¦å‘è°ƒç”¨ç»“æ„ä½“åˆå§‹åŒ–
   7           *
   8           * @param   
   9           *
  10           * @return  void
  11          **/
  12          void Power_Statu_Init( void )
  13          {
  14   1          ac_ctrl.zero_flag  = 0;
  15   1          AC_Out1 = AC_Out2 = AC_Out3 = AC_Out4 = 1;
  16   1      }
  17          
  18          /**
  19           * @brief       å¤–éƒ¨ä¸­æ–­2ä¸­æ–­å¤„ç†å‡½æ•°
  20           *
  21           * @param   
  22           *
  23           * @return  void
  24          **/
  25          void INT2_ISR( void ) interrupt 10
  26          {
  27   1          /* 1, æ£€æµ‹åˆ°å¤–éƒ¨ä¸­æ–­åï¼Œç­‰å¾…THL\TLIåè§¦å‘TIM1ä¸­æ–­       */
  28   1          TL1 = ac_ctrl.time_delay;                           
  29   1              TH1 = ac_ctrl.time_delay >> 8;                          
  30   1      
  31   1          ac_ctrl.zero_flag = 1;
  32   1      
  33   1          /* 2, å®šæ—¶å™¨1å¼€å§‹è®¡æ—¶ï¼Œæ‰“å¼€TIM1ä¸­æ–­                     */
  34   1          TR1 = 1;                                 
  35   1          ET1 = 1; 
  36   1      }
  37          
  38          /**
  39           * @brief       Timer1ä¸­æ–­å¤„ç†å‡½æ•°
  40           *
  41           * @param   
  42           *
  43           * @return  void
  44          **/
  45          void Tim1_ISR( void ) interrupt 3   //1ms
  46          {
  47   1          /* 1, ä¸­æ–­è§¦å‘åï¼Œpower_chç”µå¹³ ç”±é«˜ç”µå¹³å˜ä¸ºä½ç”µå¹³           */
  48   1          if( ac_ctrl.zero_flag == 1 )
  49   1          {
  50   2              ac_ctrl.zero_flag = 0;
  51   2              AC_Out4 = 0;
  52   2      
  53   2               /* 2, è®¾ç½®ä¸‹ä¸€æ¬¡Timer1ä¸­æ–­è§¦å‘æ‰€éœ€æ—¶é—´ï¼Œå³è„‰å†²æ—¶é—´       */
C51 COMPILER V9.60.7.0   POWER_CRL                                                         07/14/2025 11:08:35 PAGE 2   

  54   2              TL1 = 0xF7;                             
  55   2              TH1 = 0xFF;                             
  56   2          }else
  57   1          {
  58   2              /* 3, ä¸‹ä¸€æ¬¡è¿›å…¥Timer1ä¸­æ–­ï¼Œpower_chç”µå¹³ ç”±ä½ç”µå¹³å˜ä¸ºé«˜ç”µå¹³ï¼Œå®Œæˆä¸€æ¬¡10usè
             -„‰å†²ï¼Œå³æ–©æ³¢*/
  59   2              AC_Out4 = 1;
  60   2      
  61   2              /* 4, å®šæ—¶å™¨1åœæ­¢è®¡æ—¶ï¼Œå…³é—­TIM1ä¸­æ–­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å¤–éƒ¨ä¸­æ–­     */
  62   2              TR1 = 0;                                    
  63   2              ET1 = 0; 
  64   2          }
  65   1      }
  66          
  67          /**
  68           * @brief       220Vè¾“å‡ºåŠŸç‡æ§åˆ¶å‡½æ•° 
  69           *
  70           * @param   power_levelï¼šè¾“å‡ºåŠŸç‡ç™¾åˆ†æ¯”  0%~100%
  71           *
  72           * @return  void
  73          **/
  74          void bake_power_ctrl( uint8_t power_level )
  75          {
  76   1          ac_ctrl.time_delay = 56500 + 90 * power_level;
  77   1      }
  78          
  79          /**
  80           * @brief       220Vè¾“å‡ºåŠŸç‡æ§åˆ¶å‡½æ•° 
  81           *
  82           * @param   power_levelï¼šè¾“å‡ºåŠŸç‡ç™¾åˆ†æ¯”  0%~100%
  83           *
  84           * @return  void
  85          **/
  86          void bake_fan_ctrl( uint8_t level )
  87          {
  88   1          PWMB_CCR8  = level * 184;
  89   1      }
  90          
  91          /**
  92           * @brief       24V LEDå¼€å…³æ§åˆ¶å‡½æ•°
  93           *
  94           * @param   on_offï¼š0ï¼šå…³é—­ 1ï¼šå¼€å¯
  95           *
  96           * @return  void
  97          **/
  98          void led_ctrl( uint8_t on_off )
  99          {
 100   1          if( on_off == LED_ON )
 101   1          {
 102   2              DC_24V = 0;
 103   2          }else
 104   1          {
 105   2              DC_24V = 1;
 106   2          }
 107   1      }
 108          
 109          /**
 110           * @brief       24V PWMé£æ‰‡æ¡£ä½æ§åˆ¶å‡½æ•°
 111           *
 112           * @param   level :é£æ‰‡æ¡£ä½ 0~6æ¡£
 113           *
 114           * @return  void
C51 COMPILER V9.60.7.0   POWER_CRL                                                         07/14/2025 11:08:35 PAGE 3   

 115          **/
 116          void fan_ctrl( uint8_t level )
 117          {
 118   1          PWMB_CCR7  = level * 184;
 119   1      }
 120          
 121          /**
 122           * @brief       24V PWMé£æ‰‡æ¡£ä½æ§åˆ¶å‡½æ•°
 123           *
 124           * @param   level :é£æ‰‡æ¡£ä½ 0~6æ¡£
 125           *
 126           * @return  void
 127          **/
 128          void ac220_ctrl( uint8_t on_off )
 129          {
 130   1          if( on_off == POWER_ON )
 131   1          {
 132   2              AC_Out1 = AC_Out2 = AC_Out3 = 0;
 133   2          }else
 134   1          {
 135   2              AC_Out1 = AC_Out2 = AC_Out3 = 1;
 136   2          }
 137   1      }
 138          
 139          /**
 140           * @brief       ç”µæºå¼€å…³ï¼ˆå—å±å¹•æ§åˆ¶ï¼‰ 
 141           *
 142           * @param   
 143           *
 144           * @return  void
 145          **/
 146          void power_switch_ctrl( uint8_t power_switch )
 147          {
 148   1          if( power_switch == 0 )
 149   1          {
 150   2              PWMB_BKR = 0x00; 
 151   2              INTCLKO  = 0X00; 
 152   2              led_ctrl(LED_OFF);
 153   2              AC_Out1 = AC_Out2 = AC_Out3 = 1;
 154   2          }else
 155   1          {
 156   2              PWMB_BKR = 0x80;    //PWMæ§åˆ¶
 157   2              INTCLKO |= 0X10;             //å¤–éƒ¨ä¸­æ–­æ§åˆ¶
 158   2              led_ctrl(slave_06.led_switch);
 159   2          }
 160   1      }
 161          
 162          /**
 163           * @brief       åŒæ­¥æ§åˆ¶å‡½æ•°ï¼šæ— å¤–éƒ¨ä¿¡å·æ—¶ PWMé£æ‰‡å’Œ220Vè¾“å‡ºå…³é—­
 164           *
 165           * @param   
 166           *
 167           * @return  void
 168          **/
 169          void sync_ctrl( void )
 170          {
 171   1          if( slave_06.sync_switch2 == 1 )
 172   1          { 
 173   2              INTCLKO  = 0X00; 
 174   2              AC_Out1 = AC_Out2 = AC_Out3 = 1;
 175   2          }else
 176   1          {
C51 COMPILER V9.60.7.0   POWER_CRL                                                         07/14/2025 11:08:35 PAGE 4   

 177   2              INTCLKO |= 0X10;             //å¤–éƒ¨ä¸­æ–­æ§åˆ¶
 178   2          }
 179   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    238    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
